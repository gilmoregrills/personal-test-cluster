language: terraform
sudo: true
env:
  - TF_INPUT=false
before_install:
  - curl -sLo /tmp/terraform.zip https://releases.hashicorp.com/terraform/0.11.10/terraform_0.11.10_linux_amd64.zip
  - unzip /tmp/terraform.zip -d /tmp
  - mv /tmp/terraform ~/bin
  - export PATH="~/bin:$PATH"
  - openssl aes-256-cbc -K $encrypted_bdf5ae1520a9_key -iv $encrypted_bdf5ae1520a9_iv -in service_account.json.enc -out service_account.json -d
  - if [ ! -d ${HOME}/google-cloud-sdk ]; then
     curl https://sdk.cloud.google.com > gcloud-install.sh;
     chmod 755 gcloud-install.sh;
     ./gcloud-install.sh --install-dir=/home/travis --disable-prompts;
    fi
  - gcloud auth activate-service-account --key-file service_account.json
script:
- terraform init ./terraform
- terraform plan ./terraform
deploy:
- provider: script
  skip_cleanup: true
  script: terraform apply ./terraform
  on:
    branch: master